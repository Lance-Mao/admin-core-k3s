# Default values for k3s-app

# Global settings
global:
  imageRegistry: ghcr.io
  imagePullSecrets: []
  storageClass: "local-path"  # K3s default storage class

# Frontend configuration
frontend:
  enabled: true
  replicaCount: 2
  
  image:
    repository: lance-mao/core-frontend
    tag: latest
    pullPolicy: Always
  
  service:
    type: ClusterIP
    port: 80
  
  resources:
    requests:
      memory: "32Mi"
      cpu: "10m"
    limits:
      memory: "64Mi"
      cpu: "50m"

# API configuration
api:
  enabled: true
  replicaCount: 2
  
  image:
    repository: lance-mao/core-api
    tag: latest
    pullPolicy: Always
  
  service:
    type: ClusterIP
    port: 9100
    prometheusPort: 4000
  
  env:
    APP_VERSION: "1.0.0"
    ENVIRONMENT: "production"
    DEPLOY_COUNT: "1"
  
  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "100m"

  config:
    timeout: 6000
    accessExpire: 259200
    logLevel: info
    logKeepDays: 7
    captchaKeyLong: 5
    dbMaxOpenConn: 100
    cacheTime: 5
    defaultRoleId: 1
    defaultDepartmentId: 1
    defaultPositionId: 1
    allowInit: true

# Ingress configuration (nginx)
# All traffic goes to frontend, frontend nginx proxies /api/ to backend
ingress:
  enabled: true
  className: nginx
  annotations: {}
  # For SSL with cert-manager, uncomment and configure:
  # annotations:
  #   cert-manager.io/cluster-issuer: letsencrypt-prod
  #   nginx.ingress.kubernetes.io/ssl-redirect: "true"
  hosts:
    - host: ""  # Empty for IP-based access, set your domain for SSL
      paths:
        - path: /
          pathType: Prefix
          service: frontend
  # TLS configuration - uncomment for SSL
  tls: []
  # tls:
  #   - secretName: k3s-app-tls
  #     hosts:
  #       - yourdomain.com

# Pod disruption budget
podDisruptionBudget:
  enabled: false
  minAvailable: 1

# Autoscaling
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80

# Nginx Ingress Controller (as dependency)
# Set to false if nginx-ingress is already installed on your cluster
ingress-nginx:
  enabled: false
  controller:
    service:
      type: LoadBalancer
    ingressClassResource:
      name: nginx
      enabled: true
      default: true

# Monitoring configuration
# Note: kube-prometheus-stack is installed separately in 'monitoring' namespace
# This chart no longer includes it as a dependency

# MySQL Database Configuration
mysql:
  enabled: true
  replicaCount: 1

  image:
    repository: mysql
    tag: "8.0"
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    port: 3306

  persistence:
    enabled: true
    size: 10Gi
    storageClass: ""  # Use global.storageClass

  auth:
    database: simple_admin

  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "1Gi"
      cpu: "500m"

# Redis Cache Configuration
redis:
  enabled: true
  replicaCount: 1

  image:
    repository: redis
    tag: "7-alpine"
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    port: 6379

  auth:
    enabled: false  # Set to true and configure password in secrets if needed

  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "200m"

# RPC Service Configuration
rpc:
  enabled: true
  replicaCount: 2

  image:
    repository: lance-mao/core-rpc
    tag: latest
    pullPolicy: Always

  service:
    type: ClusterIP
    port: 9101
    prometheusPort: 4001

  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  config:
    logLevel: info
    logKeepDays: 7
    dbMaxOpenConn: 100
    cacheTime: 5

  autoscaling:
    enabled: false
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80

# RBAC Configuration
rbac:
  create: true
  serviceAccount:
    name: ""  # If empty, uses default name

# Persistent Storage Configuration
persistence:
  logs:
    enabled: false  # Disabled - local-path storage doesn't support ReadWriteMany
    size: 5Gi
    storageClass: ""  # Use global.storageClass

# Secrets Configuration
# IMPORTANT: These must be provided via --set or external secret management
# Never commit actual secrets to git
secrets:
  mysql:
    rootPassword: ""  # Required: Set via --set secrets.mysql.rootPassword=xxx
    username: "simple_admin"
    password: ""      # Required: Set via --set secrets.mysql.password=xxx
  jwt:
    accessSecret: ""  # Required: Set via --set secrets.jwt.accessSecret=xxx
  redis:
    password: ""      # Optional: Only needed if redis.auth.enabled=true

# Monitoring Configuration
# ServiceMonitor for Prometheus (requires prometheus-operator CRDs)
monitoring:
  serviceMonitor:
    enabled: true  # Enable if you have Prometheus Operator installed
    interval: 30s
    namespace: monitoring  # Namespace where Prometheus is running
